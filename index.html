// Handle Main Clicker
document.getElementById('mainClicker').addEventListener('click', async (e) => {
    if (!userData || !myUid) return;
    
    const power = getPower(userData.clickLevel || 1);
    
    // Floating text animation
    const popup = document.createElement('div');
    popup.className = 'popup-anim';
    popup.innerText = `+$${power}`;
    popup.style.left = `${e.pageX}px`;
    popup.style.top = `${e.pageY}px`;
    document.body.appendChild(popup);
    setTimeout(() => popup.remove(), 400);

    await updateDoc(doc(db, "users", myUid), {
        balance: increment(power)
    });
});

// Upgrade Clicker Power
window.upgradeClicker = async () => {
    const currentLevel = userData.clickLevel || 1;
    const cost = Math.floor(25 + (currentLevel - 1) * 50.5);
    
    if (userData.balance >= cost && (1 + ((currentLevel - 1) * 10)) < 500) {
        await updateDoc(doc(db, "users", myUid), {
            balance: increment(-cost),
            clickLevel: increment(1)
        });
    } else {
        alert("Not enough cash or max level reached!");
    }
};

// Buy Orbs
window.buyOrb = async (orbId, cost, currentOwned) => {
    if (userData.balance >= cost && currentOwned < 50) {
        await updateDoc(doc(db, "users", myUid), {
            balance: increment(-cost),
            [`orbs.${orbId}`]: increment(1)
        });
    }
};

// Prestige Purchase
window.buyPrestige = async (upgId, cost) => {
    if (userData.prestigePoints >= cost) {
        await updateDoc(doc(
